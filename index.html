<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×¨×•×œ×˜×” ×¤×¨×• - ×’×¨×¡×” ××ª×•×§× ×ª ×•××“×•×™×§×ª</title>
    <style>
        :root {
            --primary: #e74c3c;
            --dark: #121212;
            --panel: #1e1e1e;
            --gold: #ffc107;
            --green: #27ae60;
            --text: #ffffff;
            --felt: #0f4d22;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
            transition: background 0.5s;
        }

        /* --- ××¦×‘ ×¡×™×‘×•×‘ (×¤×•×§×•×¡) --- */
        body.is-spinning .top-section { height: 100vh; justify-content: center; background: radial-gradient(circle, #333 0%, #000 90%); }
        body.is-spinning .wheel-wrapper { transform: scale(1.4); margin-top: -50px; }
        body.is-spinning .scrollable-content, body.is-spinning footer, body.is-spinning header, body.is-spinning .tools-btn {
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }

        /* --- ×—×œ×§ ×¢×œ×™×•×Ÿ --- */
        .top-section {
            flex-shrink: 0; background: radial-gradient(circle, #2a2a2a 0%, #121212 90%);
            padding-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 20;
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); display: flex; flex-direction: column;
        }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 15px; background: rgba(0,0,0,0.3); border-bottom: 1px solid #333;
            transition: opacity 0.3s;
        }

        .balance-box { font-size: 1.1rem; font-weight: bold; color: var(--gold); display: flex; align-items: center; gap: 10px; }
        .add-btn { background: var(--green); border: none; color: white; border-radius: 50%; width: 24px; height: 24px; font-size: 18px; cursor: pointer; }
        .bet-info { font-size: 0.9rem; color: #aaa; }
        .win-display { color: var(--green); font-weight: bold; font-size: 1rem; min-width: 50px; text-align: left; }

        .wheel-wrapper {
            display: flex; justify-content: center; align-items: center;
            padding-top: 10px; position: relative; transition: transform 0.5s;
        }
        .history-strip { position: absolute; top: 5px; right: 10px; left: 10px; display: flex; justify-content: center; gap: 4px; pointer-events: none; }
        .hist-dot { width: 18px; height: 18px; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.3); font-weight: bold; }

        .game-container {
            width: 180px; height: 180px; border-radius: 50%; border: 6px solid #4e342e; position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.6);
        }
        .wheel { width: 100%; height: 100%; border-radius: 50%; transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1); }
        
        .ball-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            border-radius: 50%; pointer-events: none; 
            /* ×”×›×“×•×¨ ××¡×ª×•×‘×‘ ×™×—×“ ×¢× ×”×’×œ×’×œ */
            transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1);
        }
        .ball { 
            position: absolute; top: 5px; left: 50%; width: 12px; height: 12px; 
            background: radial-gradient(circle at 30% 30%, #fff, #999); 
            border-radius: 50%; transform: translateX(-50%); 
            box-shadow: 0 0 5px white; 
        }

        .marker { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 14px solid var(--gold); z-index: 10; filter: drop-shadow(0 2px 2px black); }
        .center-hub { position: absolute; top: 50%; left: 50%; width: 24px; height: 24px; background: var(--gold); border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 8px black; z-index: 5; }

        /* ×”×™×™×œ×™×™×˜ ×¢×œ ×”××¡×¤×¨ ×”×–×•×›×” ×‘×’×œ×’×œ */
        .wheel-winner-highlight {
            box-shadow: inset 0 0 0 3px var(--gold);
            z-index: 10;
        }

        /* --- ××–×•×¨ ×”×˜×‘×œ×” ×”×—×›× --- */
        .scrollable-content {
            flex: 1; overflow-y: auto; background: #111; padding: 10px; padding-bottom: 120px;
            display: flex; flex-direction: column; align-items: center; transition: opacity 0.3s;
            scroll-behavior: smooth;
        }

        .smart-table {
            display: grid;
            direction: ltr; /* ×—×©×•×‘ ×××•×“ ×œ×¡×“×¨ ×”××¡×¤×¨×™× */
            grid-template-columns: 1fr 25px 1fr 25px 1fr;
            width: 100%; max-width: 400px;
            background: var(--felt); padding: 8px; border-radius: 8px; border: 4px solid #3e2723;
        }

        .cell {
            height: 50px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: white; border: 1px solid rgba(255,255,255,0.15);
            font-size: 18px; border-radius: 4px; position: relative;
        }
        .cell:active { transform: scale(0.95); filter: brightness(1.2); }
        .cell.winner-highlight { background-color: var(--gold) !important; color: black !important; box-shadow: 0 0 20px var(--gold); z-index: 10; border-color: white; animation: pulse-win 0.6s infinite alternate; }
        @keyframes pulse-win { from { transform: scale(1); } to { transform: scale(1.1); } }

        .split-v { background: rgba(255,255,255,0.08); cursor: pointer; transition: 0.2s; position: relative; z-index: 5;}
        .split-h { height: 25px; grid-column: span 1; background: rgba(255,255,255,0.08); cursor: pointer; position: relative; z-index: 5;}
        .corner { height: 25px; width: 25px; background: rgba(255,255,255,0.15); cursor: pointer; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 5; }

        .bg-red { background: var(--primary); }
        .bg-blk { background: #2c3e50; }
        .bg-grn { background: var(--green); }
        .bg-spec { background: transparent; border: 1px solid rgba(255,255,255,0.4); font-size: 12px; }

        .cell-0 { grid-column: 1 / span 5; height: 40px; margin-bottom: 4px; }
        .spacer-row { grid-column: 1 / span 5; height: 10px; }

        .row-bet-group { grid-column: 1 / span 5; display: flex; gap: 4px; margin-bottom: 10px; }
        .row-bet-group .cell { flex: 1; height: 45px; font-size: 11px; }

        /* ×–'×™×˜×•×Ÿ ×¢×œ ×”×œ×•×— */
        .chip-on-board {
            position: absolute; width: 24px; height: 24px;
            background: radial-gradient(circle at 30% 30%, var(--gold), #f39c12); 
            border: 2px dashed white; border-radius: 50%;
            color: black; font-size: 9px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; box-shadow: 0 4px 5px rgba(0,0,0,0.8); pointer-events: none;
            z-index: 50; /* ×—×™×™×‘ ×œ×”×™×•×ª ×’×‘×•×” */
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* --- ×—×œ×§ ×ª×—×ª×•×Ÿ --- */
        footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(30, 30, 30, 0.98); backdrop-filter: blur(5px);
            border-top: 1px solid #444; padding: 10px 15px; padding-bottom: max(10px, env(safe-area-inset-bottom));
            display: flex; flex-direction: column; gap: 10px; z-index: 30; transition: opacity 0.3s;
        }

        .chip-rack { display: flex; justify-content: center; gap: 10px; }
        .chip {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 12px; color: #000;
            border: 2px solid transparent; transition: transform 0.1s;
        }
        .chip.active { transform: translateY(-8px); border-color: white; box-shadow: 0 0 10px white; }
        .c-1 { background: #ecf0f1; } .c-5 { background: #e74c3c; color:white; } 
        .c-10 { background: #3498db; color:white; } .c-50 { background: #f1c40f; }

        .actions { display: flex; gap: 10px; height: 50px; }
        .btn { border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; font-size: 1rem; }
        .btn-spin { flex: 2; background: linear-gradient(to right, #e74c3c, #c0392b); font-size: 1.3rem; box-shadow: 0 4px 0 #7c261e; }
        .btn-spin:active { transform: translateY(3px); box-shadow: none; }
        .btn-spin:disabled { background: #555; box-shadow: none; opacity: 0.7; }
        .btn-undo { width: 50px; background: #555; font-size: 1.2rem; }
        .btn-clear { width: 50px; background: #444; font-size: 0.9rem; }
        
        .tools-btn {
            position: absolute; top: 10px; left: 10px; z-index: 20;
            background: rgba(0,0,0,0.5); color: white; border: 1px solid #555;
            border-radius: 20px; padding: 5px 10px; font-size: 12px; transition: opacity 0.3s;
        }

        #confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100; }
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); color: white; padding: 15px 25px;
            border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; z-index: 100; text-align: center; font-size: 1.2rem; border: 1px solid var(--gold);
        }
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 90; display: none; align-items: center; justify-content: center;
        }
        .modal { background: #222; padding: 30px; border-radius: 15px; border: 2px solid var(--gold); text-align: center; width: 80%; }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>
    <div class="toast" id="toast">×”×•×“×¢×”</div>

    <div class="overlay" id="bankruptModal">
        <div class="modal">
            <h2 style="color:var(--gold)">× ×’××¨ ×”×›×¡×£! ğŸ˜±</h2>
            <p>×”×‘×™×ª ××–××™×Ÿ ××•×ª×š ×œ×¢×•×“ ×¡×™×‘×•×‘.</p>
            <button class="btn" style="background:var(--green); width:100%; padding:15px; margin-top:15px;" onclick="rescueFunds()">×§×‘×œ 1000$ ××ª× ×”</button>
        </div>
    </div>

    <div class="top-section" id="topSection">
        <header>
            <div class="balance-box">
                <span id="balanceDisplay">1000</span>$
                <button class="add-btn" onclick="addMoney()">+</button>
            </div>
            <div class="bet-info">×”×™××•×¨: <span id="betDisplay">0</span></div>
            <div class="win-display" id="winDisplay"></div>
        </header>

        <button class="tools-btn" onclick="toggleTurbo()">âš¡ ×˜×•×¨×‘×•</button>

        <div class="wheel-wrapper">
            <div class="history-strip" id="historyStrip"></div>
            <div class="game-container">
                <div class="marker"></div>
                <div class="wheel" id="wheel"></div>
                <div class="center-hub"></div>
                <div class="ball-container" id="ballContainer">
                    <div class="ball"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="scrollable-content" id="scrollContainer">
        <div class="smart-table" id="smartTable">
            <div class="cell bg-grn cell-0" id="cell-0" onclick="placeBet('0')">0</div>
            </div>
    </div>

    <footer>
        <div class="chip-rack">
            <div class="chip c-1 active" onclick="selectChip(1)">1</div>
            <div class="chip c-5" onclick="selectChip(5)">5</div>
            <div class="chip c-10" onclick="selectChip(10)">10</div>
            <div class="chip c-50" onclick="selectChip(50)">50</div>
        </div>
        <div class="actions">
            <button class="btn btn-undo" onclick="undoBet()">â†©</button>
            <button class="btn btn-spin" id="spinBtn" onclick="spin()">×¡×•×‘×‘!</button>
            <button class="btn btn-clear" onclick="clearBets()">ğŸ—‘ï¸</button>
        </div>
    </footer>

    <script>
        // ×”××¢×¨×š ×”×–×” ×§×¨×™×˜×™ - ×”×•× ×”×¡×“×¨ ×”×××™×ª×™ ×©×œ ×”××¡×¤×¨×™× ×¢×œ ×”×’×œ×’×œ (×‘×›×™×•×•×Ÿ ×”×©×¢×•×Ÿ)
        const wheelNumbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        
        let balance = parseFloat(localStorage.getItem('maor_pro_fix_v2')) || 1000;
        let bets = {};
        let currentBet = 0;
        let actionStack = [];
        let history = [];
        
        let chipValue = 1;
        let isSpinning = false;
        let isTurbo = false;
        let currentRot = 0;

        function init() {
            buildWheel();
            buildSmartTable();
            updateUI();
        }

        function getColor(n) { if(n===0) return 'green'; return redNumbers.includes(n)?'red':'black'; }

        function buildWheel() {
            const wheel = document.getElementById('wheel');
            const seg = 360 / 37;
            let grad = '';
            
            // ×‘× ×™×™×ª ×”×’×œ×’×œ ×•×™×–×•××œ×™×ª
            wheelNumbers.forEach((n, i) => {
                const c = getColor(n);
                const color = c==='green'?'#27ae60':(c==='red'?'#c0392b':'#111');
                grad += `${color} ${i*seg}deg ${(i+1)*seg}deg,`;
                
                const d = document.createElement('div');
                d.style.position='absolute'; d.style.top='0'; d.style.left='50%';
                d.style.height='50%'; d.style.width='20px'; d.style.transformOrigin='bottom center';
                
                // ×—×©×•×‘: ×××§××™× ××ª ×”××¡×¤×¨ ×‘×××¦×¢ ×”×’×–×¨×”
                d.style.transform = `translateX(-50%) rotate(${i*seg + seg/2}deg)`;
                
                d.innerHTML = `<span style="display:block; margin-top:4px; color:white; font-size:8px; font-weight:bold">${n}</span>`;
                wheel.appendChild(d);
            });
            wheel.style.background = `conic-gradient(${grad.slice(0,-1)})`;
        }

        function buildSmartTable() {
            const t = document.getElementById('smartTable');
            for(let r=1; r<=12; r++) {
                const n1 = r*3 - 2; // 1
                const n2 = r*3 - 1; // 2
                const n3 = r*3;     // 3

                t.appendChild(createNum(n1));
                t.appendChild(createSplitV(n1, n2));
                t.appendChild(createNum(n2));
                t.appendChild(createSplitV(n2, n3));
                t.appendChild(createNum(n3));

                if(r < 12) {
                    const nextN1 = n1+3;
                    const nextN2 = n2+3;
                    const nextN3 = n3+3;
                    t.appendChild(createSplitH(n1, nextN1));
                    t.appendChild(createCorner(n1, n2, nextN1, nextN2));
                    t.appendChild(createSplitH(n2, nextN2));
                    t.appendChild(createCorner(n2, n3, nextN2, nextN3));
                    t.appendChild(createSplitH(n3, nextN3));
                }
            }

            const br = document.createElement('div'); br.className = 'spacer-row'; t.appendChild(br);

            const grp1 = document.createElement('div'); grp1.className = 'row-bet-group';
            grp1.appendChild(createSpecial("2 to 1", "col1")); 
            grp1.appendChild(createSpecial("2 to 1", "col2")); 
            grp1.appendChild(createSpecial("2 to 1", "col3"));
            t.appendChild(grp1);

            const grp2 = document.createElement('div'); grp2.className = 'row-bet-group';
            grp2.appendChild(createSpecial("1st 12", "1st12"));
            grp2.appendChild(createSpecial("2nd 12", "2nd12"));
            grp2.appendChild(createSpecial("3rd 12", "3rd12"));
            t.appendChild(grp2);

            const grp3 = document.createElement('div'); grp3.className = 'row-bet-group';
            grp3.appendChild(createSpecial("1-18", "1-18"));
            grp3.appendChild(createSpecial("EVEN", "even"));
            grp3.appendChild(createSpecial("RED", "red", "bg-red"));
            t.appendChild(grp3);

            const grp4 = document.createElement('div'); grp4.className = 'row-bet-group';
            grp4.appendChild(createSpecial("BLACK", "black", "bg-blk"));
            grp4.appendChild(createSpecial("ODD", "odd"));
            grp4.appendChild(createSpecial("19-36", "19-36"));
            t.appendChild(grp4);
        }

        function createNum(n) {
            const el = document.createElement('div');
            const bg = redNumbers.includes(n) ? 'bg-red' : 'bg-blk';
            el.className = `cell ${bg}`;
            el.innerText = n;
            el.id = `cell-${n}`;
            el.dataset.bet = n;
            el.onclick = () => placeBet(n.toString());
            return el;
        }

        function createSplitV(n1, n2) {
            const el = document.createElement('div');
            el.className = 'split-v';
            el.dataset.bet = `split-${n1}-${n2}`;
            el.onclick = () => placeBet(`split-${n1}-${n2}`);
            return el;
        }

        function createSplitH(n1, n2) {
            const el = document.createElement('div');
            el.className = 'split-h';
            el.dataset.bet = `split-${n1}-${n2}`;
            el.onclick = () => placeBet(`split-${n1}-${n2}`);
            return el;
        }

        function createCorner(n1, n2, n3, n4) {
            const el = document.createElement('div');
            el.className = 'corner';
            el.dataset.bet = `corner-${n1}-${n2}-${n3}-${n4}`;
            el.onclick = () => placeBet(`corner-${n1}-${n2}-${n3}-${n4}`);
            return el;
        }

        function createSpecial(text, key, bgClass='bg-spec') {
            const el = document.createElement('div');
            el.className = `cell ${bgClass}`; el.innerText = text; el.dataset.bet = key;
            el.onclick = () => placeBet(key);
            return el;
        }

        function selectChip(v) {
            chipValue = v;
            document.querySelectorAll('.chip').forEach(c => {
                c.classList.remove('active');
                if(parseInt(c.innerText) === v) c.classList.add('active');
            });
            navigator.vibrate(20);
        }

        function placeBet(type) {
            if(isSpinning) return;
            if(balance < chipValue) { showToast("×—×¡×¨ ×›×¡×£!"); return; }

            balance -= chipValue;
            currentBet += chipValue;
            
            if(!bets[type]) bets[type]=0;
            bets[type] += chipValue;
            
            actionStack.push({type, val:chipValue});
            
            navigator.vibrate(30);
            updateUI(); renderChips();
        }

        function undoBet() {
            if(isSpinning || !actionStack.length) return;
            const act = actionStack.pop();
            balance += act.val;
            currentBet -= act.val;
            bets[act.type] -= act.val;
            if(bets[act.type]<=0) delete bets[act.type];
            updateUI(); renderChips();
        }

        function clearBets() {
            if(isSpinning) return;
            balance += currentBet;
            currentBet=0; bets={}; actionStack=[];
            updateUI(); renderChips();
        }

        function renderChips() {
            document.querySelectorAll('.chip-on-board').forEach(e=>e.remove());
            for(const [k, v] of Object.entries(bets)) {
                if(v > 0) {
                    let el = null;
                    if(!isNaN(k)) el = document.getElementById(`cell-${k}`);
                    if(!el) el = document.querySelector(`[data-bet="${k}"]`);
                    
                    if(el) {
                        const c = document.createElement('div');
                        c.className = 'chip-on-board'; 
                        c.innerText = v >= 1000 ? (v/1000).toFixed(1)+'k' : v;
                        el.appendChild(c);
                    }
                }
            }
        }

        function spin() {
            if(currentBet === 0) { showToast("×©×™× ×”×™××•×¨!"); return; }
            
            document.body.classList.add('is-spinning');
            document.getElementById('scrollContainer').scrollTo({top:0, behavior:'smooth'});
            
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;

            const winIdx = Math.floor(Math.random()*wheelNumbers.length);
            const winNum = wheelNumbers[winIdx];
            
            // ×—×™×©×•×‘ ×–×•×•×™×ª ××“×•×™×§ - ×›×“×™ ×©×”××©×•×œ×© ×™×”×™×” ×¢×œ ×”××¡×¤×¨ ×”×–×•×›×”
            const seg = 360 / 37;
            
            // ×”××™×§×•× ×”× ×•×›×—×™ ×©×œ ×”××¡×¤×¨ ×¢×œ ×”×’×œ×’×œ (×‘×™×—×¡ ×œ×”×ª×—×œ×” 0)
            const numAngle = (winIdx * seg) + (seg / 2);
            
            // ×× ×—× ×• ×¦×¨×™×›×™× ×œ×¡×•×‘×‘ ××ª ×”×’×œ×’×œ ×›×š ×©-numAngle ×™×’×™×¢ ×œ-0 ××¢×œ×•×ª (×œ××¢×œ×”)
            // ××›×™×•×•×Ÿ ×©×”×’×œ×’×œ ××¡×ª×•×‘×‘ ×¢× ×›×™×•×•×Ÿ ×”×©×¢×•×Ÿ, ×× ×—× ×• ××•×¡×™×¤×™× ×–×•×•×™×•×ª.
            // ×–×•×•×™×ª ×™×¢×“ = (×¡×™×‘×•×‘×™× ×©×œ××™×) + (360 - ×”××™×§×•× ×”× ×•×›×—×™ ×©×œ ×”××¡×¤×¨)
            
            // × ×•×¡×™×£ ××§×¨××™×•×ª ×§×˜× ×” ×‘×ª×•×š ×”×’×–×¨×” ×›×“×™ ×©×–×” ×™×¨××” ×¨×™××œ×™×¡×˜×™ (××‘×œ ×¢×“×™×™×Ÿ ×‘×ª×•×š ×”××¡×¤×¨)
            const jitter = (Math.random() * seg * 0.8) - (seg * 0.4); 

            // ×—×™×©×•×‘ ×”×¡×™×‘×•×‘ ×”× ×“×¨×©
            // × × ×™×— ×× ×—× ×• ×‘-currentRot. × ×•×¡×™×£ 5 ×¡×™×‘×•×‘×™×.
            // ×”××˜×¨×” ×”×™× ×œ×”×’×™×¢ ×œ×–×•×•×™×ª ×©×‘×” ×”-Marker (×œ××¢×œ×”) ××¦×‘×™×¢ ×¢×œ winIdx.
            // ×–×” ××•××¨ ×©×”×’×œ×’×œ ×¦×¨×™×š ×œ×”×™×•×ª ××¡×•×‘×‘ ×‘: -(winIdx * seg + seg/2)
            
            const targetRotation = -(winIdx * seg + seg / 2 + jitter);
            
            // ×›×“×™ ×œ×©××•×¨ ×¢×œ ×¨×¦×£ ×¡×™×‘×•×‘, × ×•×¡×™×£ ×›×¤×•×œ×•×ª ×©×œ 360
            const spins = 5;
            const finalRot = currentRot - (360 * spins) + (targetRotation - (currentRot % 360));
            // ×ª×™×§×•×Ÿ ×›×“×™ ×œ×•×•×“× ×©×× ×—× ×• ×ª××™×“ ××¡×ª×•×‘×‘×™× ×œ××•×ª×• ×›×™×•×•×Ÿ (×©×œ×™×œ×™ ×‘××§×¨×” ×”×–×”)
            const actualRot = currentRot - (360 * 5) - ( (currentRot % 360) - targetRotation );


            const wEl = document.getElementById('wheel');
            const bEl = document.getElementById('ballContainer');
            const time = isTurbo ? '1s' : '4s';

            wEl.style.transition = `transform ${time} cubic-bezier(0.1, 0.7, 0.1, 1)`;
            bEl.style.transition = `transform ${time} cubic-bezier(0.1, 0.7, 0.1, 1)`;
            
            // ×˜×¨×™×§: × ×¡×•×‘×‘ ××ª ×”×’×œ×’×œ ×œ× ×§×•×“×”
            // ×•× ×¡×•×‘×‘ ××ª ×”×›×“×•×¨ ×‘×“×™×•×§ ×œ××•×ª×” ×–×•×•×™×ª ×›×“×™ ×©×™×™×¨××” ×›××™×œ×• ×”×•× "× ×—" ×‘×—×¨×™×¥
            
            // ×—×™×©×•×‘ ×¤×©×•×˜ ×™×•×ª×¨ ×©×¢×•×‘×“ ×ª××™×“:
            const stopAngle = (360 * 5) + (360 - (winIdx * seg) - (seg/2));
            const totalRot = currentRot + stopAngle;
            
            // × ×©×ª××© ×‘×—×™×©×•×‘ ×”××“×•×™×§:
            // ×¨×•×¦×™× ×œ×”×’×™×¢ ×œ: -((winIdx * seg) + (seg/2))
            const nextRotation = currentRot - (360 * 5) - ((winIdx * seg + seg/2) + currentRot%360);
            
            // × ×—×–×•×¨ ×œ×¤×©×•×˜ ×•×”×‘×˜×•×—:
            // ×× ×—× ×• ×¨×•×¦×™× ×©×”××™× ×“×§×¡ winIdx ×™×”×™×” ×‘-0 ××¢×œ×•×ª (×œ××¢×œ×”).
            // ×–×” ×§×•×¨×” ×›×©×”×’×œ×’×œ ××¡×•×‘×‘ ×‘: - (winIdx * seg + seg/2)
            
            const finalAngle = -( (winIdx * seg) + (seg/2) );
            // ××•×¡×™×¤×™× ×¡×™×‘×•×‘×™× ×©×œ××™× ×œ××¦×‘ ×”× ×•×›×—×™ ×›×“×™ ×œ×”×’×™×¢ ×œ×©× ×—×œ×§
            const delta = finalAngle - (currentRot % 360);
            const realTarget = currentRot + delta - (360 * 5); // ××¡×ª×•×‘×‘ × ×’×“ ×›×™×•×•×Ÿ ×”×©×¢×•×Ÿ (××¡×¤×¨×™× ×–×–×™× ×™××™× ×”)

            wEl.style.transform = `rotate(${realTarget}deg)`;
            
            // ×”×›×“×•×¨ ××¡×ª×•×‘×‘ ×™×—×“ ×¢× ×”×’×œ×’×œ (××•×ª×• transform)
            bEl.style.transform = `rotate(${realTarget}deg)`;
            
            currentRot = realTarget;

            setTimeout(() => {
                isSpinning = false;
                document.body.classList.remove('is-spinning');
                document.getElementById('spinBtn').disabled = false;
                resolve(winNum);
            }, isTurbo?1000:4000);
        }

        function resolve(num) {
            let win = 0;
            const color = getColor(num);
            
            history.unshift(num);
            if(history.length>10) history.pop();
            renderHistory();

            let winningCell = document.getElementById(`cell-${num}`);
            if(num === 0) winningCell = document.querySelector('.cell-0');

            if(winningCell) {
                winningCell.scrollIntoView({behavior: "smooth", block: "center"});
                winningCell.classList.add('winner-highlight');
                setTimeout(() => winningCell.classList.remove('winner-highlight'), 3500);
            }

            for(const [k, v] of Object.entries(bets)) {
                let m = 0;
                if(k === num.toString()) m = 36;
                else if(k.startsWith('split')) {
                    const nums = k.split('-').slice(1).map(Number);
                    if(nums.includes(num)) m = 18;
                }
                else if(k.startsWith('corner')) {
                    const nums = k.split('-').slice(1).map(Number);
                    if(nums.includes(num)) m = 9;
                }
                else if(k==='red' && color==='red') m=2;
                else if(k==='black' && color==='black') m=2;
                else if(num!==0) {
                    if(k==='even' && num%2===0) m=2;
                    if(k==='odd' && num%2!==0) m=2;
                    if(k==='1-18' && num<=18) m=2;
                    if(k==='19-36' && num>=19) m=2;
                    if(k==='1st12' && num<=12) m=3;
                    if(k==='2nd12' && num>12 && num<=24) m=3;
                    if(k==='3rd12' && num>24) m=3;
                    if(k==='col1' && num%3===1) m=3;
                    if(k==='col2' && num%3===2) m=3;
                    if(k==='col3' && num%3===0) m=3;
                }
                win += v*m;
            }

            balance += win;
            if(win > 0) {
                showToast(`×–×›×™×ª ×‘-${win}$! ğŸ‰`);
                fireConfetti();
                const wd = document.getElementById('winDisplay');
                wd.innerText = `+${win}`;
                setTimeout(()=>wd.innerText='', 3000);
            } else {
                showToast(`×™×¦× ${num}`);
            }

            currentBet = 0; bets = {}; actionStack = []; renderChips(); updateUI();
            if(balance < 1) setTimeout(()=>document.getElementById('bankruptModal').style.display = 'flex', 1500);
        }

        function updateUI() {
            document.getElementById('balanceDisplay').innerText = balance;
            document.getElementById('betDisplay').innerText = currentBet;
            localStorage.setItem('maor_pro_fix_v2', balance);
        }

        function renderHistory() {
            const h = document.getElementById('historyStrip');
            h.innerHTML = '';
            history.forEach(n => {
                const d = document.createElement('div');
                d.className = 'hist-dot'; d.innerText=n;
                const c = getColor(n);
                d.style.backgroundColor = c==='red'?'var(--primary)':(c==='black'?'#2c3e50':'var(--green)');
                h.appendChild(d);
            });
        }

        function addMoney() { balance += 1000; updateUI(); showToast("×”×•×¡×¤×ª 1000$"); }
        function rescueFunds() { balance += 1000; updateUI(); document.getElementById('bankruptModal').style.display='none'; }
        function toggleTurbo() { isTurbo = !isTurbo; showToast(isTurbo?"×˜×•×¨×‘×•: ×¤×¢×™×œ":"×˜×•×¨×‘×•: ×›×‘×•×™"); }
        function showToast(txt) {
            const t = document.getElementById('toast');
            t.innerText = txt; t.style.opacity = 1;
            setTimeout(()=>t.style.opacity=0, 2000);
        }

        const cvs = document.getElementById('confetti-canvas');
        const ctx = cvs.getContext('2d');
        cvs.width = window.innerWidth; cvs.height = window.innerHeight;
        let confetti = [];
        function fireConfetti() {
            for(let i=0; i<100; i++) confetti.push({
                x:Math.random()*cvs.width, y:Math.random()*cvs.height-cvs.height,
                c:['#f1c40f','#e74c3c','#3498db'][Math.floor(Math.random()*3)],
                s:Math.random()*5+3, dx:Math.random()*4-2, dy:Math.random()*5+3
            });
            loopConfetti();
        }
        function loopConfetti() {
            if(!confetti.length) { ctx.clearRect(0,0,cvs.width,cvs.height); return; }
            ctx.clearRect(0,0,cvs.width,cvs.height);
            confetti.forEach((p,i)=>{
                p.y+=p.dy; p.x+=p.dx; ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,p.s,p.s);
                if(p.y>cvs.height) confetti.splice(i,1);
            });
            requestAnimationFrame(loopConfetti);
        }

        init();
    </script>
</body>
</html>
